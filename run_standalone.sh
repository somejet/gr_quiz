#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ standalone –≤–µ—Ä—Å–∏–∏ –ì—Ä–µ—á–µ—Å–∫–æ–≥–æ –ö–≤–∏–∑–∞..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ production —Å–±–æ—Ä–∫–∞
if [ ! -d "build/web" ]; then
    echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ production —Å–±–æ—Ä–∫–∏..."
    flutter build web --release
    echo ""
fi

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–µ—Ä–≤–µ—Ä –µ—Å–ª–∏ –æ–Ω –∑–∞–ø—É—â–µ–Ω
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞..."
lsof -ti:8080 | xargs kill -9 2>/dev/null || true

# –ó–∞–ø—É—Å–∫–∞–µ–º HTTP —Å–µ—Ä–≤–µ—Ä
echo "üåê –ó–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞..."
cd build/web
python3 -m http.server 8080 --bind 0.0.0.0 &

# –ü–æ–ª—É—á–∞–µ–º IP –∞–¥—Ä–µ—Å
IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}')

echo ""
echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ!"
echo ""
echo "üì± –î–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:"
echo "   http://$IP:8080"
echo ""
echo "üíª –î–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ:"
echo "   http://localhost:8080"
echo ""
echo "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
echo ""

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
wait
